/**
 * ç®€å•çš„AIè®²è§£é£æ ¼æµ‹è¯•
 * æ¨¡æ‹Ÿä¸åŒå­¦ç§‘çš„promptç”Ÿæˆ
 */

// æ¨¡æ‹ŸgenerateDynamicPromptå‡½æ•°
function generateDynamicPrompt(topic, subject, curriculumInfo) {
  // å®šä¹‰å¤šç§è®²è§£é£æ ¼
  const explanationStyles = [
    {
      name: "æ•…äº‹åŒ–è®²è§£",
      prompt: `ä½ æ˜¯ä¸€ä½å–„äºè®²æ•…äº‹çš„è€å¸ˆã€‚è¯·ç”¨ç”ŸåŠ¨çš„æ•…äº‹å’Œæ¯”å–»æ¥è®²è§£"${topic}"ï¼Œè®©æŠ½è±¡çš„æ¦‚å¿µå˜å¾—å…·ä½“å¯æ„Ÿã€‚

ğŸ¯ è®²è§£è¦æ±‚ï¼š
- ç”¨æ•…äº‹å¼€å¤´ï¼Œå¼•å‡ºçŸ¥è¯†ç‚¹
- é€šè¿‡ç”Ÿæ´»ä¸­çš„ä¾‹å­å’Œæ¯”å–»å¸®åŠ©ç†è§£
- è¯­è¨€ç”ŸåŠ¨æœ‰è¶£ï¼Œé¿å…æ¯ç‡¥çš„ç†è®ºå †ç Œ
- é€‚å½“åŠ å…¥äº’åŠ¨æé—®ï¼Œå¼•å‘æ€è€ƒ

${curriculumInfo || ''}

è¯·ç”¨è½»æ¾æ„‰å¿«çš„è¯­è°ƒï¼Œåƒæœ‹å‹èŠå¤©ä¸€æ ·è®²è§£è¿™ä¸ªçŸ¥è¯†ç‚¹ã€‚`
    },
    {
      name: "é—®é¢˜å¯¼å‘å¼",
      prompt: `ä½ æ˜¯ä¸€ä½å–„äºå¯å‘æ€è€ƒçš„å¯¼å¸ˆã€‚è¯·é€šè¿‡æå‡ºä¸€ç³»åˆ—é€’è¿›çš„é—®é¢˜æ¥å¼•å¯¼å­¦ç”Ÿç†è§£"${topic}"ã€‚

ğŸ¯ è®²è§£è¦æ±‚ï¼š
- ä»å­¦ç”Ÿç†Ÿæ‚‰çš„ç°è±¡å¼€å§‹æé—®
- é€æ­¥æ·±å…¥ï¼Œå±‚å±‚é€’è¿›
- æ¯ä¸ªé—®é¢˜éƒ½æœ‰æ˜ç¡®çš„æ€è€ƒæ–¹å‘
- åœ¨è§£ç­”ä¸­è‡ªç„¶å¼•å‡ºæ ¸å¿ƒæ¦‚å¿µ

${curriculumInfo || ''}

è¯·ç”¨è‹æ ¼æ‹‰åº•å¼çš„é—®ç­”æ–¹å¼ï¼Œå¼•å¯¼å­¦ç”Ÿä¸»åŠ¨æ€è€ƒå’Œå‘ç°ã€‚`
    },
    {
      name: "å®ç”¨æŠ€èƒ½å¼",
      prompt: `ä½ æ˜¯ä¸€ä½æ³¨é‡å®ç”¨æ€§çš„æ•™ç»ƒã€‚è¯·é‡ç‚¹è®²è§£"${topic}"çš„å®é™…åº”ç”¨å’Œè§£é¢˜æŠ€å·§ã€‚

ğŸ¯ è®²è§£è¦æ±‚ï¼š
- ç›´æ¥ç‚¹å‡ºæ ¸å¿ƒè¦ç‚¹å’Œå…³é”®æŠ€å·§
- æä¾›å…·ä½“çš„è§£é¢˜æ­¥éª¤å’Œæ–¹æ³•
- åˆ†æå¸¸è§é”™è¯¯å’Œé¿å…æ–¹æ³•
- ç»™å‡ºå®é™…åº”ç”¨åœºæ™¯

${curriculumInfo || ''}

è¯·ç”¨ç®€æ´æ˜äº†çš„è¯­è¨€ï¼Œé‡ç‚¹çªå‡ºå®ç”¨æ€§å’Œå¯æ“ä½œæ€§ã€‚`
    },
    {
      name: "æ¢ç´¢å‘ç°å¼",
      prompt: `ä½ æ˜¯ä¸€ä½é¼“åŠ±æ¢ç´¢çš„å¼•è·¯äººã€‚è¯·å¼•å¯¼å­¦ç”Ÿåƒç§‘å­¦å®¶ä¸€æ ·æ¢ç´¢å’Œå‘ç°"${topic}"çš„å¥¥ç§˜ã€‚

ğŸ¯ è®²è§£è¦æ±‚ï¼š
- ä»è§‚å¯Ÿç°è±¡å¼€å§‹ï¼Œå¼•å‘å¥½å¥‡å¿ƒ
- é¼“åŠ±å­¦ç”Ÿæå‡ºå‡è®¾å’ŒçŒœæƒ³
- é€šè¿‡å®éªŒæˆ–æ¨ç†éªŒè¯æƒ³æ³•
- æ€»ç»“è§„å¾‹å’ŒåŸç†

${curriculumInfo || ''}

è¯·ç”¨å……æ»¡å¥½å¥‡å¿ƒçš„è¯­è°ƒï¼Œæ¿€å‘å­¦ç”Ÿçš„æ¢ç´¢æ¬²æœ›ã€‚`
    },
    {
      name: "å¯¹æ¯”åˆ†æå¼",
      prompt: `ä½ æ˜¯ä¸€ä½å–„äºåˆ†æçš„æ€ç»´å¯¼å¸ˆã€‚è¯·é€šè¿‡å¯¹æ¯”å’Œåˆ†æçš„æ–¹å¼æ¥è®²è§£"${topic}"ã€‚

ğŸ¯ è®²è§£è¦æ±‚ï¼š
- æ‰¾å‡ºç›¸ä¼¼æ¦‚å¿µè¿›è¡Œå¯¹æ¯”
- åˆ†æå¼‚åŒç‚¹å’Œè”ç³»
- æ„å»ºçŸ¥è¯†ä¹‹é—´çš„å…³ç³»ç½‘ç»œ
- å¸®åŠ©å­¦ç”Ÿå»ºç«‹ç³»ç»Ÿæ€§ç†è§£

${curriculumInfo || ''}

è¯·ç”¨é€»è¾‘æ¸…æ™°çš„æ–¹å¼ï¼Œå¸®åŠ©å­¦ç”Ÿå»ºç«‹å®Œæ•´çš„çŸ¥è¯†ä½“ç³»ã€‚`
    },
    {
      name: "åˆ›æ„è”æƒ³å¼",
      prompt: `ä½ æ˜¯ä¸€ä½å¯Œæœ‰åˆ›æ„çš„è€å¸ˆã€‚è¯·ç”¨åˆ›æ–°çš„è§’åº¦å’Œæœ‰è¶£çš„è”æƒ³æ¥è®²è§£"${topic}"ã€‚

ğŸ¯ è®²è§£è¦æ±‚ï¼š
- è¿ç”¨åˆ›æ„æ€ç»´å’Œè”æƒ³
- è¿æ¥ä¸åŒé¢†åŸŸçš„çŸ¥è¯†
- ç”¨æ–°é¢–çš„è§†è§’è§£è¯»ä¼ ç»Ÿæ¦‚å¿µ
- æ¿€å‘å­¦ç”Ÿçš„æƒ³è±¡åŠ›

${curriculumInfo || ''}

è¯·ç”¨å¯Œæœ‰åˆ›æ„å’Œæƒ³è±¡åŠ›çš„æ–¹å¼ï¼Œè®©å­¦ä¹ å˜å¾—æœ‰è¶£å’Œéš¾å¿˜ã€‚`
    }
  ];

  // æ ¹æ®å­¦ç§‘ç‰¹ç‚¹é€‰æ‹©åˆé€‚çš„é£æ ¼
  let preferredStyles = [];
  
  if (subject) {
    switch (subject.toLowerCase()) {
      case 'æ•°å­¦':
      case 'math':
        preferredStyles = ['å®ç”¨æŠ€èƒ½å¼', 'é—®é¢˜å¯¼å‘å¼', 'å¯¹æ¯”åˆ†æå¼'];
        break;
      case 'ç‰©ç†':
      case 'physics':
        preferredStyles = ['æ¢ç´¢å‘ç°å¼', 'å®ç”¨æŠ€èƒ½å¼', 'æ•…äº‹åŒ–è®²è§£'];
        break;
      case 'åŒ–å­¦':
      case 'chemistry':
        preferredStyles = ['æ¢ç´¢å‘ç°å¼', 'å¯¹æ¯”åˆ†æå¼', 'å®ç”¨æŠ€èƒ½å¼'];
        break;
      case 'å†å²':
      case 'history':
        preferredStyles = ['æ•…äº‹åŒ–è®²è§£', 'å¯¹æ¯”åˆ†æå¼', 'é—®é¢˜å¯¼å‘å¼'];
        break;
      case 'è¯­æ–‡':
      case 'chinese':
        preferredStyles = ['æ•…äº‹åŒ–è®²è§£', 'åˆ›æ„è”æƒ³å¼', 'é—®é¢˜å¯¼å‘å¼'];
        break;
      case 'è‹±è¯­':
      case 'english':
        preferredStyles = ['å®ç”¨æŠ€èƒ½å¼', 'æ•…äº‹åŒ–è®²è§£', 'å¯¹æ¯”åˆ†æå¼'];
        break;
      case 'ç”Ÿç‰©':
      case 'biology':
        preferredStyles = ['æ¢ç´¢å‘ç°å¼', 'æ•…äº‹åŒ–è®²è§£', 'å¯¹æ¯”åˆ†æå¼'];
        break;
      case 'åœ°ç†':
      case 'geography':
        preferredStyles = ['æ•…äº‹åŒ–è®²è§£', 'æ¢ç´¢å‘ç°å¼', 'å¯¹æ¯”åˆ†æå¼'];
        break;
      default:
        preferredStyles = ['é—®é¢˜å¯¼å‘å¼', 'æ•…äº‹åŒ–è®²è§£', 'å®ç”¨æŠ€èƒ½å¼'];
    }
  } else {
    preferredStyles = ['é—®é¢˜å¯¼å‘å¼', 'æ•…äº‹åŒ–è®²è§£', 'å®ç”¨æŠ€èƒ½å¼'];
  }

  // éšæœºé€‰æ‹©ä¸€ç§é£æ ¼ï¼Œä½†åå‘äºå­¦ç§‘é€‚åˆçš„é£æ ¼
  const availableStyles = explanationStyles.filter(style => 
    preferredStyles.includes(style.name)
  );
  
  const selectedStyle = availableStyles.length > 0 
    ? availableStyles[Math.floor(Math.random() * availableStyles.length)]
    : explanationStyles[Math.floor(Math.random() * explanationStyles.length)];

  return { style: selectedStyle.name, prompt: selectedStyle.prompt };
}

// æµ‹è¯•ä¸åŒå­¦ç§‘çš„é£æ ¼é€‰æ‹©
console.log('ğŸ§ª æµ‹è¯•AIè®²è§£é£æ ¼ç³»ç»Ÿ\n');

const testCases = [
  { subject: 'å†å²', topic: 'ä¸­æ—¥ç”²åˆæˆ˜äº‰' },
  { subject: 'æ•°å­¦', topic: 'äºŒæ¬¡å‡½æ•°' },
  { subject: 'ç‰©ç†', topic: 'ç‰›é¡¿ç¬¬äºŒå®šå¾‹' },
  { subject: 'è¯­æ–‡', topic: 'å¤è¯—è¯é‰´èµ' },
  { subject: 'è‹±è¯­', topic: 'è¿‡å»å®Œæˆæ—¶' },
  { subject: 'åŒ–å­¦', topic: 'é…¸ç¢±ååº”' }
];

testCases.forEach((testCase, index) => {
  console.log(`\n--- æµ‹è¯• ${index + 1}: ${testCase.subject} - ${testCase.topic} ---`);
  
  // ç”Ÿæˆ5æ¬¡ï¼Œçœ‹çœ‹é£æ ¼çš„å¤šæ ·æ€§
  const styles = [];
  for (let i = 0; i < 5; i++) {
    const result = generateDynamicPrompt(testCase.topic, testCase.subject);
    styles.push(result.style);
  }
  
  console.log(`ğŸ¨ ç”Ÿæˆçš„é£æ ¼: ${styles.join(', ')}`);
  console.log(`ğŸ“Š é£æ ¼å¤šæ ·æ€§: ${new Set(styles).size}/5 ç§ä¸åŒé£æ ¼`);
  
  // æ˜¾ç¤ºä¸€ä¸ªç¤ºä¾‹promptçš„å¼€å¤´
  const example = generateDynamicPrompt(testCase.topic, testCase.subject);
  console.log(`ğŸ“ ç¤ºä¾‹é£æ ¼: ${example.style}`);
  console.log(`ğŸ“„ Promptå¼€å¤´: ${example.prompt.substring(0, 150)}...`);
});

console.log('\nâœ… æµ‹è¯•å®Œæˆï¼æ–°çš„AIè®²è§£ç³»ç»Ÿå·²ç»å®ç°äº†å¤šæ ·åŒ–çš„é£æ ¼é€‰æ‹©ã€‚');
console.log('ğŸ‰ ä¸åŒå­¦ç§‘ä¼šä¼˜å…ˆé€‰æ‹©é€‚åˆçš„è®²è§£é£æ ¼ï¼ŒåŒæ—¶ä¿æŒéšæœºæ€§é¿å…å›ºå®šæ ¼å¼ã€‚');